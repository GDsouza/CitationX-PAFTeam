<?xml version="1.0" encoding="ISO-8859-1"?>

<PropertyList>

  <!-- Starting APU -->

  <flipflop>
    <type>RS</type>
    <S>
      <and>
        <property>systems/electrical/outputs/apu-ecu</property>
        <property>controls/APU/start-stop</property>
      </and>
    </S>
    <R>
      <or>
        <not>
          <property>controls/APU/master</property>
        </not>
        <equals>
          <property>controls/APU/start-stop</property>
          <value>-1</value>
        </equals>
        <not>
          <property>systems/electrical/outputs/apu-ecu</property>
        </not>
      </or>
    </R>
    <output>controls/APU/running</output>
  </flipflop>

  <filter>
    <type>noise-spike</type>
    <max-rate-of-change>0.0333</max-rate-of-change>
    <input>controls/APU/running</input>
    <output>controls/APU/rpm</output>
  </filter>

  <!-- Auto-disconnect APU generator-->

  <flipflop>
    <type>RS</type>
    <S>
      <and>
        <property>systems/electrical/outputs/apu-ecu</property>
        <property>controls/APU/running</property>
        <property>controls/APU/gen-switch</property>
      </and>
    </S>
    <R>
      <or>
        <greater-than>
          <property>systems/electrical/right-gen-volts</property>
          <value>27</value>
        </greater-than>
        <not>
          <property>systems/electrical/outputs/apu-ecu</property>
        </not>
        <less-than>
          <property>controls/APU/gen-switch</property>
          <value>1</value>
        </less-than>
      </or>
    </R>
    <output>controls/APU/generator</output>
  </flipflop>

  <!-- Auto-disconnect external power -->

  <flipflop>
    <type>RS</type>
    <enable>
      <condition>
        <property>controls/electric/external-power</property>
      </condition>
    </enable>
    <R>
      <or>
        <equals>
          <property>systems/electrical/right-gen-volts</property>
          <value>28</value>
        </equals>
        <equals>
          <property>systems/electrical/apu-gen-volts</property>
          <value>28</value>
        </equals>
      </or>
    </R>
    <output>controls/electric/external-power</output>
  </flipflop>

  <!-- Cross-tie automatic control.         
    We use the state machine and not logic or flip flop to allow the pilot
    to override the selection manually.    
  -->

  <state-machine>
    <state><name>open</name></state>
    <state><name>closed</name></state>
    <transition>
      <name>auto-close</name>
      <source>open</source>
      <target>closed</target>
      <condition>
        <and>
          <or>
            <property>controls/electric/external-power</property>
            <property>controls/electric/batt1-switch</property>
            <property>controls/electric/batt2-switch</property>
          </or>
          <property>gear/gear[0]/wow</property>
          <not>
            <property>engines/engine[1]/generator</property>
          </not>
        </and>
      </condition>
      <binding>
        <command>property-assign</command>
          <property>controls/electric/xtie-open</property>
          <value>0</value>
      </binding>
    </transition>
    <transition>
      <name>auto-open</name>
      <source>closed</source>
      <target>open</target>
      <condition>
        <and>
          <property>gear/gear[0]/wow</property>
          <property>engines/engine[1]/generator</property>
        </and>
      </condition>
      <binding>
        <command>property-assign</command>
          <property>controls/electric/xtie-open</property>
          <value>1</value>
      </binding>
    </transition>
  </state-machine>

  <!-- Create boolean property for right main bus -->

  <logic>
    <input>
      <greater-than>
        <property>systems/electrical/right-main-bus-volts</property>
        <value>10</value>
      </greater-than>
    </input>
    <output>systems/electrical/right-main-bus</output>
  </logic>

  <!-- Convert anti-collision control to beacon and strobe -->

  <logic>
    <input>
      <greater-than>
        <property>controls/lighting/anti-coll</property>
        <value>0</value>
      </greater-than>
    </input>
    <output>controls/lighting/beacons</output>
  </logic>

  <logic>
    <input>
      <equals>
        <property>controls/lighting/anti-coll</property>
        <value>2</value>
      </equals>
    </input>
    <output>controls/lighting/strobes</output>
  </logic>

  <!-- Set Boost-pumps-->
  <flipflop>
    <type>RS</type>
    <S>
      <equals>
        <property>controls/fuel/tank[0]/boost-btn</property>
        <value>2</value>
      </equals>
    </S>
    <R>
      <property>systems/electrical/cb/lh-boost-pump-fuse-tripped</property>
    </R>
    <output>controls/fuel/tank[0]/boost-pump</output>
  </flipflop>

  <flipflop>
    <type>RS</type>
    <S>
      <equals>
        <property>controls/fuel/tank[1]/boost-btn</property>
        <value>2</value>
      </equals>
    </S>
    <R>
      <property>systems/electrical/cb/rh-boost-pump-fuse-tripped</property>
    </R>
    <output>controls/fuel/tank[1]/boost-pump</output>
  </flipflop>


  <!-- Set the ALS system to taxi and Landing lights-->

    <!-- Landing light Left -->

  <state-machine>
    <state><name>on</name></state>
    <state><name>off</name></state>
    <transition>
      <name>auto-on</name>
      <source>off</source>
      <target>on</target>
      <condition>
        <and>
          <property>controls/lighting/landing-light</property>
          <greater-than>
            <property>systems/electrical/left-main-bus-volts</property>
            <value>10</value>
          </greater-than>
        </and>
      </condition>
      <binding>
        <command>property-assign</command>
          <property>sim/rendering/als-secondary-lights/use-landing-light</property>
          <value>1</value>
      </binding>
      <binding>
        <command>property-assign</command>
        <property>sim/rendering/als-secondary-lights/landing-light1-offset-deg</property>
        <value>-5</value>
      </binding>
      <binding>
        <command>property-assign</command>
        <property>sim/rendering/als-secondary-lights/landing-light2-offset-deg</property>
        <value>0</value>
      </binding>
      <binding>
        <command>property-assign</command>
        <property>sim/rendering/als-secondary-lights/landing-light3-offset-deg</property>
        <value>2</value>
      </binding>
    </transition>
    <transition>
      <name>auto-off</name>
      <source>on</source>
      <target>off</target>
      <condition>
        <or>
          <not>
            <property>controls/lighting/landing-light</property>
          </not>
          <less-than>
            <property>systems/electrical/left-main-bus-volts</property>
            <value>11</value>
          </less-than>
        </or>
      </condition>
      <binding>
        <command>property-assign</command>
          <property>sim/rendering/als-secondary-lights/use-landing-light</property>
          <value>0</value>
      </binding>
    </transition>
  </state-machine>

    <!-- Landing light right -->

  <state-machine>
    <state><name>on</name></state>
    <state><name>off</name></state>
    <transition>
      <name>auto-on</name>
      <source>off</source>
      <target>on</target>
      <condition>
        <and>
          <property>controls/lighting/landing-light[1]</property>
          <greater-than>
            <property>systems/electrical/right-main-bus-volts</property>
            <value>10</value>
          </greater-than>
        </and>
      </condition>
      <binding>
        <command>property-assign</command>
          <property>sim/rendering/als-secondary-lights/use-alt-landing-light</property>
          <value>1</value>
      </binding>
      <binding>
        <command>property-assign</command>
        <property>sim/rendering/als-secondary-lights/landing-light1-offset-deg</property>
        <value>0</value>
      </binding>
      <binding>
        <command>property-assign</command>
        <property>sim/rendering/als-secondary-lights/landing-light2-offset-deg</property>
        <value>5</value>
      </binding>
      <binding>
        <command>property-assign</command>
        <property>sim/rendering/als-secondary-lights/landing-light3-offset-deg</property>
        <value>2</value>
      </binding>
    </transition>
    <transition>
      <name>auto-off</name>
      <source>on</source>
      <target>off</target>
      <condition>
        <or>
          <not>
            <property>controls/lighting/landing-light[1]</property>
          </not>
          <less-than>
            <property>systems/electrical/right-main-bus-volts</property>
            <value>11</value>
          </less-than>
        </or>
      </condition>
      <binding>
        <command>property-assign</command>
          <property>sim/rendering/als-secondary-lights/use-alt-landing-light</property>
          <value>0</value>
      </binding>
    </transition>
  </state-machine>

    <!-- Landing light Left + Right -->

  <state-machine>
    <state><name>on</name></state>
    <state><name>off</name></state>
    <transition>
      <name>auto-on</name>
      <source>off</source>
      <target>on</target>
      <condition>
        <and>
          <property>controls/lighting/landing-light</property>
          <property>controls/lighting/landing-light[1]</property>
          <greater-than>
            <property>systems/electrical/right-main-bus-volts</property>
            <value>10</value>
          </greater-than>
        </and>
      </condition>
      <binding>
        <command>property-assign</command>
          <property>sim/rendering/als-secondary-lights/use-landing-light</property>
          <value>1</value>
      </binding>
      <binding>
        <command>property-assign</command>
          <property>sim/rendering/als-secondary-lights/use-alt-landing-light</property>
          <value>1</value>
      </binding>
      <binding>
        <command>property-assign</command>
        <property>sim/rendering/als-secondary-lights/landing-light1-offset-deg</property>
        <value>-5</value>
      </binding>
      <binding>
        <command>property-assign</command>
        <property>sim/rendering/als-secondary-lights/landing-light2-offset-deg</property>
        <value>5</value>
      </binding>
      <binding>
        <command>property-assign</command>
        <property>sim/rendering/als-secondary-lights/landing-light3-offset-deg</property>
        <value>2</value>
      </binding>
    </transition>
    <transition>
      <name>auto-off</name>
      <source>on</source>
      <target>off</target>
      <condition>
        <or>
          <and>
            <not>
                <property>controls/lighting/landing-light</property>
              </not>
              <not>
                <property>controls/lighting/landing-light[1]</property>
              </not>
          </and>
          <less-than>
            <property>systems/electrical/right-main-bus-volts</property>
            <value>11</value>
          </less-than>
        </or>
      </condition>
      <binding>
        <command>property-assign</command>
          <property>sim/rendering/als-secondary-lights/use-alt-landing-light</property>
          <value>0</value>
      </binding>
      <binding>
        <command>property-assign</command>
        <property>sim/rendering/als-secondary-lights/landing-light1-offset-deg</property>
        <value>0</value>
      </binding>
      <binding>
        <command>property-assign</command>
        <property>sim/rendering/als-secondary-lights/landing-light2-offset-deg</property>
        <value>0</value>
      </binding>
      <binding>
        <command>property-assign</command>
        <property>sim/rendering/als-secondary-lights/landing-light3-offset-deg</property>
        <value>0</value>
      </binding>
    </transition>
  </state-machine>

    <!-- Taxi lights -->

  <state-machine>
    <state><name>on</name></state>
    <state><name>off</name></state>
    <transition>
      <name>auto-on</name>
      <source>off</source>
      <target>on</target>
      <condition>
        <and>
          <property>controls/lighting/taxi-light</property>
          <greater-than>
            <property>systems/electrical/left-main-bus-volts</property>
            <value>10</value>
          </greater-than>
        </and>
      </condition>
      <binding>
        <command>property-assign</command>
          <property>sim/rendering/als-secondary-lights/use-landing-light</property>
          <value>1</value>
      </binding>
      <binding>
        <command>property-assign</command>
          <property>sim/rendering/als-secondary-lights/use-alt-landing-light</property>
          <value>1</value>
      </binding>
      <binding>
        <command>property-assign</command>
        <property>sim/rendering/als-secondary-lights/landing-light1-offset-deg</property>
        <value>5</value>
      </binding>
      <binding>
        <command>property-assign</command>
        <property>sim/rendering/als-secondary-lights/landing-light2-offset-deg</property>
        <value>-5</value>
      </binding>
      <binding>
        <command>property-assign</command>
        <property>sim/rendering/als-secondary-lights/landing-light3-offset-deg</property>
        <value>2</value>
      </binding>
    </transition>
    <transition>
      <name>auto-off</name>
      <source>on</source>
      <target>off</target>
      <condition>
        <or>
          <and>
            <not>
              <property>controls/lighting/taxi-light</property>
            </not>
            <not>
              <property>controls/lighting/landing-light</property>
            </not>
            <not>
              <property>controls/lighting/landing-light[1]</property>
            </not>
          </and>
          <less-than>
            <property>systems/electrical/left-main-bus-volts</property>
            <value>11</value>
          </less-than>
        </or>
      </condition>
      <binding>
        <command>property-assign</command>
          <property>sim/rendering/als-secondary-lights/use-landing-light</property>
          <value>0</value>
      </binding>
      <binding>
        <command>property-assign</command>
          <property>sim/rendering/als-secondary-lights/use-alt-landing-light</property>
          <value>0</value>
      </binding>
      <binding>
        <command>property-assign</command>
        <property>sim/rendering/als-secondary-lights/landing-light1-offset-deg</property>
        <value>0</value>
      </binding>
      <binding>
        <command>property-assign</command>
        <property>sim/rendering/als-secondary-lights/landing-light2-offset-deg</property>
        <value>0</value>
      </binding>
      <binding>
        <command>property-assign</command>
        <property>sim/rendering/als-secondary-lights/landing-light3-offset-deg</property>
        <value>0</value>
      </binding>
    </transition>
  </state-machine>

  <!-- Cockpit Lights -->

  <filter>
      <name>Flood</name>
      <type>gain</type>
      <gain>1.0</gain>
      <input>
        <condition>
          <property>systems/electrical/outputs/cockpit-flood</property>
        </condition>
        <property>controls/lighting/flood</property>
      </input>
      <input>
        <condition>
          <not>
            <property>systems/electrical/outputs/cockpit-flood</property>
          </not>
        </condition>
        <value>0.001</value>
      </input>
      <output>controls/lighting/flood-norm</output>
	</filter>

  <filter>
      <name>El</name>
      <type>gain</type>
      <gain>1.0</gain>
      <input>
        <condition>
          <and>
            <property>systems/electrical/outputs/el-panel</property>
            <property>controls/lighting/day-night</property>
          </and>
        </condition>
        <property>controls/lighting/el</property>
      </input>
      <input>
        <condition>
          <or>
            <not>
              <property>systems/electrical/outputs/el-panel</property>
            </not>
            <not>
              <property>controls/lighting/day-night</property>
            </not>
          </or>
        </condition>
        <value>0.001</value>
      </input>
      <output>controls/lighting/el-norm</output>
	</filter>

  <filter>
      <name>Lh</name>
      <type>gain</type>
      <gain>1.0</gain>
      <input>
        <condition>
          <and>
            <property>systems/electrical/outputs/lh-panel</property>
            <property>controls/lighting/day-night</property>
          </and>
        </condition>
        <property>controls/lighting/lh</property>
      </input>
      <input>
        <condition>
          <or>
            <not>
              <property>systems/electrical/outputs/lh-panel</property>
            </not>
            <not>
              <property>controls/lighting/day-night</property>
            </not>
          </or>
        </condition>
        <value>0.001</value>
      </input>
      <output>controls/lighting/lh-norm</output>
	</filter>

  <filter>
      <name>Rh</name>
      <type>gain</type>
      <gain>1.0</gain>
      <input>
        <condition>
          <and>
            <property>systems/electrical/outputs/rh-panel</property>
            <property>controls/lighting/day-night</property>
          </and>
        </condition>
        <property>controls/lighting/rh</property>
      </input>
      <input>
        <condition>
          <or>
            <not>
              <property>systems/electrical/outputs/rh-panel</property>
            </not>
            <not>
              <property>controls/lighting/day-night</property>
            </not>
          </or>
        </condition>
        <value>0.001</value>
      </input>
      <output>controls/lighting/rh-norm</output>
	</filter>

  <filter>
      <name>Ctr</name>
      <type>gain</type>
      <gain>1.0</gain>
      <input>
        <condition>
          <and>
            <property>systems/electrical/outputs/ctr-panel</property>
            <property>controls/lighting/day-night</property>
          </and>
        </condition>
        <property>controls/lighting/ctr</property>
      </input>
      <input>
        <condition>
          <or>
            <not>
              <property>systems/electrical/outputs/ctr-panel</property>
            </not>
            <not>
              <property>controls/lighting/day-night</property>
            </not>
          </or>
        </condition>
        <value>0.001</value>
      </input>
      <output>controls/lighting/ctr-norm</output>
	</filter>

</PropertyList>

